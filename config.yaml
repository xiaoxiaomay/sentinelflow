embedding:
  model_name: "sentence-transformers/all-MiniLM-L6-v2"
  chunk_size: 800     # for langchain_text_splitters
  chunk_overlap: 100  # for langchain_text_splitters

openai_model: "gpt-4o-mini"

db:
  host: "18.220.95.90"
  name: "sentinel_db"
  user: "postgres"
  password: "root"
  port : 5432

paths:
  secret_index: "data/index/secrets.faiss"
  secret_meta:  "data/index/secrets_meta.pkl"
  docs_dir : "datasource/docs" # internal documents

rag:
  top_k: 5
  candidate_k: 50
  max_context_chars_per_doc: 1200

audit:
  out_dir: "data/audit"
  file_name: "audit_log.jsonl"

# -------------------------
# Gate 0: intent rules
# -------------------------
policy:
  block_message: "[BLOCKED] Unsafe intent detected by SentinelFlow."
  intent_rules:
    # Prompt injection / role override
    - id: INJ_01
      name: prompt_injection_override
      severity: high
      action: block
      patterns:
        - "ignore\\s+all\\s+previous\\s+instructions"
        - "ignore\\s+the\\s+documents"
        - "disregard\\s+the\\s+system"
        - "developer\\s+mode"
        - "jailbreak"
        - "do\\s+anything\\s+now"
        - "you\\s+are\\s+now\\s+a\\s+system\\s+admin"
        - "override\\s+the\\s+rules"
        - "output\\s+everything\\s+you\\s+know"
        - "even\\s+if\\s+not\\s+in\\s+docs"

    # System prompt / hidden instructions / policies
    - id: SYS_01
      name: system_prompt_exfiltration
      severity: high
      action: block
      patterns:
        - "reveal\\s+your\\s+system\\s+prompt"
        - "reveal\\s+the\\s+system\\s+prompt"
        - "print\\s+the\\s+system\\s+prompt"
        - "hidden\\s+instructions"
        - "internal\\s+policy"
        - "policy\\s+rules"

    # Audit log / internal files exfil
    - id: AUD_01
      name: audit_log_exfiltration
      severity: high
      action: block
      patterns:
        - "print\\s+the\\s+full\\s+audit\\s+log"
        - "audit\\s+log\\s+file"
        - "dump\\s+the\\s+audit"
        - "show\\s+me\\s+the\\s+audit\\s+log"
        - "contents\\s+of\\s+audit"

    # "Internal only" / restricted sources
    - id: INT_01
      name: internal_only_request
      severity: high
      action: block
      patterns:
        - "^internal\\s+only"
        - "restricted\\s+data\\s+sources"
        - "restricted\\s+dataset"
        - "client\\s+sensitive"
        - "proprietary"
        - "confidential"
        - "\\bsecret\\b"
        - "^secret:"

    # Embeddings / vectors / secret index data exfil
    - id: EXF_01
      name: data_exfiltration_request
      severity: high
      action: block
      patterns:
        - "tell\\s+me\\s+the\\s+secret"
        - "confidential\\s+strategy"
        - "internal\\s+alpha\\s+rule"
        - "rsi\\s*<\\s*25\\s+strategy\\s+logic"
        - "exact\\s+buy\\s*-?signal\\s+rule"
        - "entry\\s+conditions\\s+for\\s+the\\s+rsi"
        - "internal\\s+threshold"
        - "list\\s+any\\s+secret\\s+ids"
        - "return\\s+the\\s+embedding\\s+vectors"
        - "secret\\s+index"
        - "provide\\s+the\\s+restricted\\s+dataset\\s+names"

  # -------------------------
  # Gate 0b: hard-block class (generic exfiltration)
  # Minimal, rule-based "classifier":
  # block if (exfil_verb AND sensitive_object) OR direct_pattern hit
  # -------------------------
  hard_block:
    enabled: true
    action: block
    severity: high
    name: hard_block_exfiltration_class

    # If any of these regex patterns match, block immediately
    direct_patterns:
      - "system\\s*prompt"
      - "hidden\\s+instructions"
      - "internal\\s+policy"
      - "audit\\s*log"
      - "secret\\s+index"
      - "embedding\\s+vectors?"
      - "api\\s*key|openai\\s*key"
      - "passwords?|credentials?"
      - "private\\s+keys?"

    # exfiltration verbs (substring match, case-insensitive)
    exfil_verbs:
      - "reveal"
      - "show"
      - "print"
      - "dump"
      - "export"
      - "leak"
      - "exfiltrate"
      - "return"
      - "give me"
      - "provide"
      - "output"
      - "display"
      - "list"
      - "full"
      - "entire"

    # sensitive objects (substring match, case-insensitive)
    sensitive_objects:
      - "system prompt"
      - "prompt"
      - "hidden instruction"
      - "policy"
      - "audit log"
      - "audit"
      - "secret"
      - "secret index"
      - "secrets.faiss"
      - "finder_meta.pkl"
      - "secrets_meta.pkl"
      - "embedding"
      - "vector"
      - "weights"
      - "api key"
      - "openai key"
      - "password"
      - "credential"
      - "private key"
      - "token"      




# -------------------------
# Gate 1: embedding precheck (secret similarity)
# -------------------------
query_precheck:
  enabled: true
  threshold: 0.60
  top_k_secrets: 3
  block_message: "[BLOCKED] This query is too similar to internal confidential topics."

# -------------------------
# Grounding check
# -------------------------
grounding:
  enabled: true
  threshold: 0.55
  action: "redact"
  max_doc_chars: 1500
  block_on_ungrounded: false
  ungrounded_block_ratio: 0.50

# -------------------------
# Postcheck: leakage scan
# -------------------------
leakage:
  hard_threshold: 0.70
  soft_threshold: 0.60
  cascade_k: 2
  action: "redact"
  top_k_secrets: 1

# -------------------------
# Digital Fingerprinting (DFP)
# -------------------------
dfp:
  enabled: false                    # default off for backward compatibility
  weights:
    entropy: 0.35
    cooccurrence: 0.65
  entropy_baselines:                # computed by calibrate_dfp.py
    char_entropy_mean: 4.2
    char_entropy_std: 0.5
    word_entropy_mean: 8.5
    word_entropy_std: 1.0
    numeric_density_mean: 0.03
    numeric_density_std: 0.02
    param_specificity_mean: 0.15
    param_specificity_std: 0.08
  cooccurrence:
    threshold_operator_weight: 0.25
    conjunction_weight: 0.20
    actionable_verb_weight: 0.25
    time_window_weight: 0.15
    position_sizing_weight: 0.15
    density_threshold: 0.65
  cluster:
    strategy_centroid_path: "data/index/dfp_strategy_centroid.pkl"
    normal_centroid_path: "data/index/dfp_normal_centroid.pkl"
    distance_threshold: 2.5          # Mahalanobis distance
  dfp_boost: 0.08
  composite_threshold: 0.70
  financial_allowlist:
    - "RSI"
    - "MACD"
    - "EBITDA"
    - "P/E"
    - "EPS"
    - "Sharpe"
    - "VWAP"
    - "TWAP"
    - "SMA"
    - "EMA"
    - "ATR"
    - "ADV"
    - "NAV"
    - "AUM"
    - "VaR"
    - "VIX"
    - "ROIC"
    - "FCF"
    - "ROE"
    - "ROA"
    - "ETF"
    - "ADR"
    - "IPO"
    - "WACC"
    - "CAPM"
    - "OBV"
    - "Bollinger"
    - "Fibonacci"
    - "Stochastic"

# -------------------------
# Llama Guard / PromptGuard
# -------------------------
guard:
  enabled: false                    # start disabled, enable when ready
  backend: "promptguard"            # "promptguard" | "llamaguard3" | "api"
  model_path: "meta-llama/Prompt-Guard-86M"
  timeout_s: 2.0
  fail_mode: "closed"              # "closed" = block on timeout, "open" = allow
  categories:
    - "S1"
    - "S2"
    - "S5"
    - "S8"
    - "S13"

# -------------------------
# Benchmarking
# -------------------------
benchmark:
  datasets:
    jailbreakbench:
      source: "JailbreakBench/JBB-Behaviors"
      local_cache: "data/benchmark/jailbreakbench.jsonl"
    advbench:
      source: "data/raw/harmful_behaviors.csv"
      local_cache: "data/benchmark/advbench_prompts.jsonl"
    salesforce_prompt_leakage:
      source: "salesforce/prompt-leakage"
      subset: "finance"
      local_cache: "data/benchmark/salesforce_leakage.jsonl"
    financial_phrasebank:
      source: "data/raw/FinancialPhraseBank-v1.0/Sentences_AllAgree.txt"
      local_cache: "data/benchmark/financial_phrasebank.jsonl"
      sample_size: 200
      seed: 42
    custom_exfil:
      source: "data/benchmark/custom_strategy_exfil.jsonl"
  garak:
    probes:
      - "promptinject"
      - "leakreplay"
      - "latentinjection"
      - "dan"
      - "encoding"
    target: "http://localhost:8000/v1/chat/completions"
  reports_dir: "reports"
  timeout_per_query_s: 60

# -------------------------
# configuration for scraper
# -------------------------
scraper:
  # item_limit: 10         # 抓取达到数目后 关闭爬虫蜘蛛 (这个是scrapy的全局设置，会形成抓取的马太效应，暂时不用)
  item_per_source : 15     # 每个源各抓10个
  concurrent_requests: 3   # 并发数量

# -------------------------
# chunk configuration for docs ingestion
# -------------------------
ingestion:
  chunk_size : 500          # The approximate number of characters in each chunk
  chunk_overlap : 50        # The overlap between blocks prevents semantic breaks